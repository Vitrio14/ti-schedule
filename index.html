<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheda Trasporto Infermi</title>
    
    <link rel="icon" type="image/png" href="favicon.png">

    <style>
        :root {
            --emergency-red: #d32f2f;
            --dark-red: #9a0007;
            --success-green: #2e7d32;
            --glass-white: rgba(255, 255, 255, 0.95);
            --overlay: rgba(0, 0, 0, 0.7);
            --calendar-blue: #4285f4;
            --accent-glow: rgba(211, 47, 47, 0.3);
        }

        body { 
            font-family: 'Inter', 'Segoe UI', Roboto, sans-serif; 
            background: radial-gradient(circle at top left, #2c0000, #1a1a1a 50%, #000000);
            background-attachment: fixed;
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
            color: #333;
            min-height: 100vh;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='30' height='30' viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15 0l15 15-15 15L0 15z' fill='%23ffffff' fill-opacity='0.02' fill-rule='evenodd'/%3E%3C/svg%3E");
            z-index: -1;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast {
            background: #fff; color: #1a1a1a; padding: 14px 28px; border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); margin-bottom: 12px;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            font-size: 0.95rem; font-weight: 600; border-left: 6px solid var(--emergency-red);
            display: flex; align-items: center; backdrop-filter: blur(10px);
        }
        .toast.success { border-left-color: var(--success-green); }
        .toast.info { border-left-color: #607d8b; }

        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: scale(0.9); } }

        #confirm-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--overlay); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 3000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 24px; text-align: center;
            max-width: 320px; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        .app-card { 
            width: 100%; max-width: 580px; 
            background: var(--glass-white); border-radius: 28px; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.5);
            overflow: hidden; animation: fadeInUp 0.6s ease-out;
        }

        .header {
            background: linear-gradient(135deg, var(--emergency-red), var(--dark-red));
            padding: 40px 20px; text-align: center; color: white;
            position: relative; overflow: hidden;
        }

        .header::after {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .header img { 
            max-width: 120px; position: relative; z-index: 1;
            filter: drop-shadow(0 8px 15px rgba(0,0,0,0.4));
            margin-bottom: 15px; transition: transform 0.3s ease;
        }
        .header img:hover { transform: scale(1.05); }

        .header h1 { 
            margin: 0; font-size: 1.4rem; text-transform: uppercase; 
            letter-spacing: 3px; font-weight: 800; position: relative; z-index: 1;
        }

        .content { padding: 30px; }

        .section-label {
            font-size: 0.85rem; font-weight: 800; color: var(--emergency-red);
            text-transform: uppercase; margin: 35px 0 15px 0;
            display: flex; align-items: center; gap: 12px; letter-spacing: 1px;
        }
        .section-label::after { content: ""; flex: 1; height: 2px; background: linear-gradient(to right, #eee, transparent); }

        .input-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.8rem; font-weight: 700; color: #555; margin-bottom: 6px; margin-left: 4px; }

        input, select, textarea { 
            width: 100%; padding: 14px; border: 2px solid #edf2f7; border-radius: 14px; 
            font-size: 1rem; box-sizing: border-box; background: #f8fafc;
            transition: all 0.3s ease; color: #2d3748;
            font-family: inherit;
        }

        input:focus, select:focus { 
            outline: none; border-color: var(--emergency-red); 
            background: #fff; box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .actions { margin-top: 40px; display: flex; flex-direction: column; gap: 12px; }

        button {
            padding: 18px; border: none; border-radius: 16px;
            font-size: 1.05rem; font-weight: 700; cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }

        button:active { transform: scale(0.97); }

        .btn-gen { 
            background: linear-gradient(135deg, var(--emergency-red), var(--dark-red)); 
            color: white; box-shadow: 0 10px 20px rgba(211, 47, 47, 0.3);
        }
        .btn-gen:hover { box-shadow: 0 15px 25px rgba(211, 47, 47, 0.4); transform: translateY(-2px); }

        .btn-cal { 
            background: white; color: var(--calendar-blue); 
            border: 2px solid var(--calendar-blue);
        }
        .btn-cal:hover { background: var(--calendar-blue); color: white; transform: translateY(-2px); }

        .btn-clear { 
            background: transparent; color: #a0aec0; border: 2px dashed #cbd5e0; margin-top: 10px;
        }
        .btn-clear:hover { border-color: #718096; color: #718096; background: rgba(0,0,0,0.02); }

        #result-box { 
            display: none; padding: 25px; background: #1a202c; 
            border-radius: 0 0 28px 28px; animation: fadeInUp 0.4s ease;
        }
        #output { 
            height: 280px; font-family: 'Fira Code', monospace; font-size: 0.85rem; 
            resize: none; background: #2d3748; color: #edf2f7; border: none; padding: 15px;
            border-radius: 12px; line-height: 1.5;
        }
        .btn-copy { 
            background: #2ecc71; color: white; width: 100%; margin-top: 15px; 
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        .btn-copy:hover { background: #27ae60; transform: translateY(-2px); }

        @media (max-width: 480px) {
            .row { grid-template-columns: 1fr; }
            .app-card { border-radius: 0; }
            body { padding: 0; }
        }
    </style>
</head>
<body>

<div id="toast-container"></div>

<div id="confirm-modal">
    <div class="modal-content">
        <p style="font-weight: 700; color: #1a202c; font-size: 1.1rem;">Vuoi svuotare la scheda?</p>
        <p style="color: #718096; font-size: 0.9rem; margin-bottom: 25px;">L'operazione non √® reversibile.</p>
        <div class="modal-btns">
            <button class="btn-no" style="background: #f1f5f9; color: #475569; flex: 1;" onclick="closeConfirm(false)">Annulla</button>
            <button class="btn-yes" style="background: var(--emergency-red); color: white; flex: 1;" onclick="closeConfirm(true)">Svuota</button>
        </div>
    </div>
</div>

<div class="app-card">
    <div class="header">
        <img src="logo.png" alt="Logo">
        <h1>Scheda Paziente</h1>
    </div>

    <div class="content">
        <form id="transportForm">
            <div class="section-label">üìã Dati Trasporto</div>
            
            <div class="row">
                <div class="input-group"><label>Missione</label><input type="text" id="missione" placeholder="Es. 000/2026/TI"></div>
                <div class="input-group"><label>Data</label><input type="date" id="data"></div>
            </div>

            <div class="input-group"><label>Nome e cognome paziente</label><input type="text" id="paziente" placeholder="Mario Rossi"></div>
            
            <div class="row">
                <div class="input-group"><label>Anni</label><input type="number" id="anni" placeholder="Et√†"></div>
                <div class="input-group"><label>Corporatura (Kg)</label><input type="number" id="peso" placeholder="Peso"></div>
            </div>

            <div class="input-group">
                <label>Motivo trasporto</label>
                <select id="motivo">
                    <option value="">Seleziona...</option>
                    <option value="Ricovero">Ricovero</option>
                    <option value="Dimissione">Dimissione</option>
                    <option value="Visita di controllo A/R">Visita di controllo A/R</option>
                    <option value="Visita tra ospedali">Visita tra ospedali</option>
                    <option value="PSS">PSS</option>
                    <option value="Terapia iperbarica">Terapia iperbarica</option>
                </select>
            </div>

            <div class="input-group"><label>Patologia</label><input type="text" id="patologia" placeholder="Descrizione breve e dettagliata"></div>
            <div class="input-group"><label>Partenza da</label><input type="text" id="partenza" placeholder="Indirizzo di partenza"></div>
            <div class="input-group"><label>Arrivo a</label><input type="text" id="arrivo" placeholder="Indirizzo di arrivo"></div>
            
            <div class="row">
                <div class="input-group"><label>P.D.C. (Riferimento)</label><input type="text" id="pdc" placeholder="Nome parente"></div>
                <div class="input-group"><label>Cellulare</label><input type="number" id="cell" placeholder="Numero di telefono"></div>
            </div>
            <div class="input-group"><label>Email</label><input type="email" id="email" placeholder="esempio@mail.com"></div>

            <div class="section-label">üöë Team Assegnato</div>
            <div class="input-group"><label>Autista Soccorritore</label><input type="text" id="autista"></div>
            <div class="input-group"><label>1¬∞ Soccorritore</label><input type="text" id="soc1"></div>
            <div class="input-group"><label>2¬∞ Soccorritore</label><input type="text" id="soc2"></div>
            <div class="input-group"><label>3¬∞ Soccorritore</label><input type="text" id="soc3"></div>
            <div class="row">
                <div class="input-group"><label>Operatore SCU</label><input type="text" id="scu"></div>
                <div class="input-group"><label>Tirocinante</label><input type="text" id="tirocinante"></div>
            </div>

            <div class="section-label">‚è∞ Info Orarie</div>
            <div class="row">
                <div class="input-group"><label>Incontro in sede</label><input type="time" id="oreSede"></div>
                <div class="input-group"><label>Arrivo dal paziente</label><input type="time" id="orePaziente"></div>
            </div>
            <div class="input-group"><label>Arrivo a destinazione</label><input type="time" id="oreDestinazione"></div>

            <div class="section-label">üí≥ Logistica e Prezzo</div>
            <div class="input-group"><label>Mezzo assegnato</label><input type="text" id="mezzo" placeholder="Ambulanza / Dobl√≤"></div>
            
            <div class="row">
                <div class="input-group"><label>Prezzo (‚Ç¨)</label><input type="number" id="prezzo" placeholder="0.00"></div>
                <div class="input-group">
                    <label>Pagamento</label>
                    <select id="pagamento">
                        <option value="">Metodo...</option>
                        <option value="Contanti">Contanti</option>
                        <option value="Bonifico">Bonifico</option>
                        <option value="POS">POS</option>
                    </select>
                </div>
            </div>
            <div class="input-group"><label>Prelevare dalla sede</label><input type="text" id="dpi" placeholder="Zaino, bombola, etc."></div>
        </form>

        <div class="actions">
            <button class="btn-gen" onclick="generate()">‚ú® Genera Messaggio</button>
            <button class="btn-cal" onclick="addToCalendar()">üìÖ Aggiungi a Calendar</button>
            <button class="btn-clear" onclick="openConfirm()">üóëÔ∏è Pulisci Scheda</button>
        </div>
    </div>

    <div id="result-box">
        <textarea id="output" readonly></textarea>
        <button class="btn-copy" id="copyBtn" onclick="copy()">üìã Copia Messaggio</button>
    </div>
</div>

<script>
    function showToast(message, type = 'default') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerText = message;
        container.appendChild(toast);
        setTimeout(() => { 
            toast.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => toast.remove(), 500); 
        }, 3000);
    }

    function openConfirm() {
        document.getElementById('confirm-modal').style.display = 'flex';
    }

    function closeConfirm(confirmed) {
        document.getElementById('confirm-modal').style.display = 'none';
        if (confirmed) {
            document.getElementById('transportForm').reset();
            document.getElementById('result-box').style.display = 'none';
            showToast("üóëÔ∏è Scheda riportata allo stato iniziale", "info");
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    function formatDateIta(dateStr) {
        if (!dateStr || dateStr === "---") return "---";
        const [year, month, day] = dateStr.split('-');
        return `${day}/${month}/${year}`;
    }

    function getFullText() {
        const v = (id) => document.getElementById(id).value || "---";
        const dataFormattata = formatDateIta(v('data'));

        return `*DATI TRASPORTO*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
*Missione:* ${v('missione')}
*Data:* ${dataFormattata}
*Nome e cognome paziente:* ${v('paziente')}
*Anni:* ${v('anni')}
*Corporatura:* ${v('peso')} Kg.
*Motivo trasporto:* ${v('motivo')}
*Patologia:* ${v('patologia')}
*Partenza da:* ${v('partenza')}
*Arrivo a:* ${v('arrivo')}
*P.D.C.:* ${v('pdc')}
*Cell:* ${v('cell')}
*Email:* ${v('email')}

*TEAM*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
*Autista Soccorritore:* ${v('autista')}
*1¬∞ Soccorritore:* ${v('soc1')}
*2¬∞ Soccorritore:* ${v('soc2')}
*3¬∞ Soccorritore:* ${v('soc3')}
*Operatore SCU:* ${v('scu')}
*Tirocinante:* ${v('tirocinante')}

*INFO UTILI*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
*Incontro in sede ore:* ${v('oreSede')}
*Arrivo dal paziente ore:* ${v('orePaziente')}
*Arrivo a destinazione ore:* ${v('oreDestinazione')}

*LOGISTICA E PREZZO*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
*Mezzo assegnato:* ${v('mezzo')}
*Prezzo concordato:* ${v('prezzo')} ‚Ç¨
*Modalit√† di pagamento:* ${v('pagamento')}
*Prelevare dalla sede:* ${v('dpi')}

*NOTE IMPORTANTI*
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
- Per effettuare il servizio sar√† necessaria la divisa completa e scarpe antinfortunistiche.
- Effettuare la check list del mezzo prima della partenza.
- Dopo la 1¬™ ora di servizio: +‚Ç¨20,00 per ogni ora di attesa.
- Portare il foglio per la fatturazione. Compilare il foglio e consegnarlo in sede ai ragazzi del servizio civile.
- Il team √® responsabile della compilazione corretta del foglio di marcia.
- Fotografare il foglio di marcia e inviarlo in chat a fine servizio.
- Vietato condividere dati sensibili fuori dalla chat.
- In caso in cui ci fossero cambiamenti o problemi di qualunque natura, contattare tempestivamente i referenti del servizio e informare qui sul gruppo`;
    }

    function addToCalendar() {
        const v = (id) => document.getElementById(id).value;
        const dataInput = v('data');
        const oraInizio = v('oreSede');
        const oraFine = v('oreDestinazione');

        if (!dataInput || !oraInizio) {
            showToast("‚ö†Ô∏è Seleziona Data e Ora Incontro", "info");
            return;
        }

        const dataGoogle = dataInput.replace(/-/g, '');
        const inizio = oraInizio.replace(':', '') + "00";
        const fine = (oraFine) ? oraFine.replace(':', '') + "00" : (parseInt(inizio) + 10000).toString();

        const titolo = encodeURIComponent(`${v('missione')} - ${v('paziente')}`);
        const testoCompleto = getFullText();
        const dettagli = encodeURIComponent(testoCompleto);
        const luogo = encodeURIComponent(v('partenza'));
        const accountEmail = "postazione.trasporti.cri.ta@gmail.com";

        const calUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${titolo}&dates=${dataGoogle}T${inizio}/${dataGoogle}T${fine}&details=${dettagli}&location=${luogo}&src=${accountEmail}&sf=true&output=xml`;

        window.open(calUrl, '_blank');
        showToast("üìÖ Apertura Google Calendar...", "success");
    }

    function generate() {
        const res = getFullText();
        document.getElementById('output').value = res;
        document.getElementById('result-box').style.display = 'block';
        showToast("‚úÖ Messaggio generato correttamente", "success");
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function copy() {
        const out = document.getElementById('output');
        out.select();
        document.execCommand('copy');
        showToast("üìã Copiato negli appunti!", "success");
    }
</script>

</body>
</html>
